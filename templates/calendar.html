<!-- vscode-css-language-features.disable -->
<div class="space-y-4 sm:space-y-6">
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0">
            <h2 class="text-lg sm:text-xl font-semibold">{{ month_name }} {{ year }} üóìÔ∏è</h2>
            <div class="flex gap-2 w-full sm:w-auto">
                {% set prev_year = year - 1 if month == 1 else year %}
                {% set prev_month = 12 if month == 1 else month - 1 %}
                {% set next_year = year + 1 if month == 12 else year %}
                {% set next_month = 1 if month == 12 else month + 1 %}
                <button hx-get="/calendar?user_id={{ user_id }}&year={{ prev_year }}&month={{ prev_month }}" hx-target="#calendar-content" hx-params="none" class="flex-1 sm:flex-none bg-gray-200 text-gray-700 px-4 py-2.5 sm:px-3 sm:py-1 rounded-lg sm:rounded hover:bg-gray-300 active:bg-gray-400 transition-all min-h-[44px] sm:min-h-0 text-sm sm:text-base">
                    <svg class="w-5 h-5 sm:w-4 sm:h-4 mx-auto sm:mx-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <button hx-get="/calendar?user_id={{ user_id }}" hx-target="#calendar-content" hx-params="none" class="flex-1 sm:flex-none bg-gray-200 text-gray-700 px-4 py-2.5 sm:px-3 sm:py-1 rounded-lg sm:rounded hover:bg-gray-300 active:bg-gray-400 transition-all min-h-[44px] sm:min-h-0 text-sm sm:text-base font-medium">Today</button>
                <button hx-get="/calendar?user_id={{ user_id }}&year={{ next_year }}&month={{ next_month }}" hx-target="#calendar-content" hx-params="none" class="flex-1 sm:flex-none bg-gray-200 text-gray-700 px-4 py-2.5 sm:px-3 sm:py-1 rounded-lg sm:rounded hover:bg-gray-300 active:bg-gray-400 transition-all min-h-[44px] sm:min-h-0 text-sm sm:text-base">
                    <svg class="w-5 h-5 sm:w-4 sm:h-4 mx-auto sm:mx-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-2 sm:p-4 overflow-x-auto -mx-2 sm:mx-0">
            <div class="grid grid-cols-7 gap-1 sm:gap-1 min-w-[300px] sm:min-w-0">
                {% for day in ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'] %}
                <div class="text-center text-[9px] sm:text-sm text-gray-500 py-1 sm:py-2 font-semibold sm:font-medium uppercase">{{ day }}</div>
                {% endfor %}

                {% for week in calendar %}
                    {% for day in week %}
                        {% if day == 0 %}
                        <div class="aspect-square bg-gray-50 min-h-[44px] sm:min-h-0"></div>
                        {% else %}
                            {% set date_str = "%04d-%02d-%02d"|format(year, month, day) %}
                            {% set completion_data = day_completions.get(date_str, {"completed": 0, "total": 0, "percentage": 0}) %}
                            {% set is_today = date_str == today %}
                            {% set percentage = completion_data.percentage|int %}
                            {% set circumference = 100.531 %}
                            {% set offset = circumference - (percentage / 100.0) * circumference %}
                            
                            <div class="aspect-square p-0.5 sm:p-1 relative flex items-center justify-center min-h-[44px] sm:min-h-0 {% if is_today %}ring-2 ring-blue-500 rounded-lg{% endif %}">
                                <div class="w-full h-full rounded-lg hover:bg-gray-50 active:bg-gray-100 transition-all flex items-center justify-center relative">
                                    <!-- Circular progress indicator - simplified for mobile -->
                                    <svg class="absolute inset-0 w-full h-full transform -rotate-90" viewBox="0 0 40 40" style="overflow: visible;">
                                        <!-- Background circle -->
                                        <circle cx="20" cy="20" r="16" fill="none" stroke="#e5e7eb" stroke-width="2.5"/>
                                        <!-- Progress circle -->
                                        {% if percentage > 0 %}
                                        <circle 
                                            cx="20" 
                                            cy="20" 
                                            r="16" 
                                            fill="none" 
                                            stroke="#6366f1" 
                                            stroke-width="2.5"
                                            stroke-dasharray="{{ circumference }}"
                                            stroke-dashoffset="{{ offset }}"
                                            stroke-linecap="round"
                                            style="transition: stroke-dashoffset 0.3s ease;"
                                        />
                                        {% endif %}
                                    </svg>
                                    <!-- Day number and percentage - simplified -->
                                    <div class="relative z-10 flex flex-col items-center justify-center pointer-events-none">
                                        <span class="text-base sm:text-xs font-bold sm:font-medium text-gray-800 sm:text-gray-700 leading-none">{{ day }}</span>
                                        {% if completion_data.total > 0 and percentage > 0 %}
                                        <span class="hidden sm:inline text-[10px] text-gray-500 mt-0.5 font-medium leading-none">{{ percentage }}%</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </div>
        </div>
        
        {% if not habits %}
        <div class="bg-white rounded-lg shadow p-8 text-center text-gray-500">
            Add habits to start tracking
        </div>
        {% endif %}
